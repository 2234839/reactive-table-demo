import{d as defineComponent,h as reactive,r as ref,b as computed,w as watchEffect,n as nextTick,p as pushScopeId,i as popScopeId,o as openBlock,a as createBlock,c as createVNode,t as toDisplayString,j as withDirectives,v as vModelCheckbox,k as vModelText,F as Fragment,l as renderList,e as createTextVNode,m as withScopeId}from"./index.08251072.js";var _sfc_main=defineComponent({setup(){const e=reactive([[new Td("1"),new Td("sum(select([0,1]))",!0),new Td("sum(select([0,0])) + 42",!0)],[new Td("2"),new Td("2"),new Td("2")],[new Td("sumFilterNaN(select([0,0],[0,1],[0,2]))",!0),new Td("sum(select([1,0],[1,1],[1,2]))",!0),new Td("sumFilterNaN(select([2,0],[2,1]))",!0)]]);{let a=function(e,t){t>0&&(e(),a(e,t-1))};a(t,8),a(n,8),e[0].forEach(((e,t)=>{0===t||(1===t?(e.isExp=!0,e.value=`sum(select([0,${t-1}]))`):(e.isExp=!0,e.value=`sum(select([0,${t-1}],[0,${t-2}]))`))})),e[1].forEach(((e,t)=>{0===t?(e.isExp=!0,e.value="sum(select([0,10]))"):1===t?(e.isExp=!0,e.value=`sum(select([0,10],[1,${t-1}]))`):(e.isExp=!0,e.value=`sum(select([1,${t-1}],[1,${t-2}]))`)})),e[2].forEach(((e,t)=>{0===t||(e.isExp=!0,e.value=`sum(select([2,${t-1}])) * 2`)}))}function t(){e.forEach((e=>e.push(new Td("1"))))}function n(){const t=e[0].map((()=>new Td("1")));e.push(t)}const a=ref(new Td("")),o=computed((()=>a.value.isExp?[...a.value.value.matchAll(/\[(\d+),(\d+)\]/g)].map((t=>e[Number(t[1])][Number(t[2])])):[]));const d=ref(new Td("")),c=ref({show:!1});const l=ref([]);function i(e,t=performance.now()){l.value.push([e,t])}const s=computed((()=>[...l.value].reverse()));i(`// ${(new Date).toLocaleString()} 程序启动`),watchEffect((()=>{const e=l.value.length;nextTick((()=>{if(e===l.value.length&&!l.value[e-1][0].startsWith("//")){const t=s.value.findIndex((e=>e[0].startsWith("//")))-1,n=l.value[e-1][1]-s.value[t][1];i(`// ${(new Date).toLocaleString()} 计算完毕,耗时 ${n}ms`)}}))}));let r=0;const u=computed((()=>e.map((t=>t.map((t=>(console.log("<new computed>"),computed((()=>{const n=evaluation(t,e);return r+=1,i(`第${r}次计算，[${求坐标(t,e)}] 处的值为<${t.isExp?"exp":"raw"} ${n}>`),{value:n,updateTheOrder:r}})))))))));return{table:e,computedTable:u,updateLogView:s,addNewRow:n,addNewCol:t,selectTd:a,select:function(e){a.value=e},editTd:d,editState:c,edit:function(e){d.value=e,c.value.show=!0},mayBeAssociatedTd:o}}});class Td{constructor(e="",t=!1,n=null){this.value=e,this.isExp=t,this.cache=n}}function evaluation(td,table){try{return evaluation1(td,[])}catch(error){return String(error)}function evaluation1(td,env){if(env.includes(td))throw`<发现[${求坐标(td,table)}]处存在循环引用，无法求值>`;if(td.isExp){if(null===td.cache||0===env.length){const e=inter(td.value);return td.cache=e,e}return td.cache}return td.value;function inter(exp){function select(...e){return e.map((e=>table[e[0]][e[1]]))}function sum(e){return e.reduce(((e,t)=>e+Number(evaluation1(t,[...env,td]))),0)}function sumFilterNaN(e){return e.reduce(((e,t)=>{const n=Number(evaluation1(t,[...env,td]));return isNaN(n)?e:e+n}),0)}return console.log("<inter>"),eval(exp,[select,sum,sumFilterNaN])}}}function 求坐标(e,t){const n=t.findIndex((t=>t.includes(e)));return[n,t[n].findIndex((t=>t===e))]}var index_vue_vue_type_style_index_0_scoped_true_lang="\n.c-row[data-v-dbab9214] {\n    display: grid;\n    grid-template-columns: var(--c-col);\n    grid-auto-rows: minmax(100px, auto);\n}\n.c-td[data-v-dbab9214] {\n    position: relative;\n\n    border: 1px solid #333;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n.c-td.-editing[data-v-dbab9214] {\n    border-color: rgb(243, 150, 11);\n    background: rgb(231, 231, 231);\n}\n.c-td.-is_exp[data-v-dbab9214] {\n    color: rgb(30, 148, 0);\n    font-size: 16px;\n    font-weight: bold;\n}\n.c-td.-depended[data-v-dbab9214] {\n    background: rgb(233, 167, 46);\n}\n.c-td-no[data-v-dbab9214] {\n    position: absolute;\n    left: 2px;\n    top: 2px;\n    height: 16px;\n    min-width: 16px;\n    font-size: 12px;\n    background: #333;\n    color: #fff;\n    cursor: default;\n}\ndiv[data-v-dbab9214] {\n    color: red;\n}\n.c-log[data-v-dbab9214] {\n    text-align: left;\n    padding-left: 20vw;\n}\n";const _withId=withScopeId();pushScopeId("data-v-dbab9214");const _hoisted_1={style:{display:"flex","align-items":"center","justify-content":"space-between"}},_hoisted_2={title:"鼠标所在单元格的原始内容"},_hoisted_3={class:"c-edit",style:{color:"#333",border:"1px solid #333",padding:"2px 8px",margin:"0 6px"}},_hoisted_4=createTextVNode(" 编辑："),_hoisted_5=createVNode("div",{style:{"font-size":"12px"}},"鼠标点击单元格切换当前编辑",-1),_hoisted_6={class:"c-log"},_hoisted_7=createVNode("div",{style:{color:"#333"}},[createVNode("h2",null,"要求"),createVNode("pre",null,"      1. 每个单元格的第一部分表示 一个展示出来的值，第二部分表示 这个单元格内是不是表达式，第三部分表示真实的值\n\n      2. 有新增行和列的功能\n\n    ")],-1);popScopeId();const _sfc_render=_withId(((e,t,n,a,o,d)=>(openBlock(),createBlock(Fragment,null,[createVNode("button",{onClick:t[1]||(t[1]=(...t)=>e.addNewRow&&e.addNewRow(...t))},"添加一行"),createVNode("button",{onClick:t[2]||(t[2]=(...t)=>e.addNewCol&&e.addNewCol(...t))},"添加一列"),createVNode("div",{style:{"--c-col":"repeat("+e.table[0].length+", 1fr)"}},[createVNode("div",_hoisted_1,[createVNode("div",_hoisted_2,"rawData:"+toDisplayString(e.selectTd.value),1),createVNode("div",_hoisted_3,[_hoisted_4,withDirectives(createVNode("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=t=>e.editTd.isExp=t),title:"是否为表达式"},null,512),[[vModelCheckbox,e.editTd.isExp]]),withDirectives(createVNode("textarea",{type:"text",style:{width:"40vw"},"onUpdate:modelValue":t[4]||(t[4]=t=>e.editTd.value=t),title:"当前单元格的原始值"},null,512),[[vModelText,e.editTd.value]]),_hoisted_5])]),(openBlock(!0),createBlock(Fragment,null,renderList(e.table,((t,n)=>(openBlock(),createBlock("div",{class:"c-row",key:n},[(openBlock(!0),createBlock(Fragment,null,renderList(t,((t,a)=>(openBlock(),createBlock("div",{class:["c-td",{"-editing":e.editTd===t,"-is_exp":t.isExp,"-depended":e.mayBeAssociatedTd.includes(t)}],key:a,title:"position:"+n+","+a,onMouseover:n=>e.select(t),onClick:n=>e.edit(t)},[createVNode("div",{class:"c-td-no",title:"这是第"+e.computedTable[n][a].value.updateTheOrder+"次计算得到的值"},toDisplayString(e.computedTable[n][a].value.updateTheOrder),9,["title"]),createTextVNode(" "+toDisplayString(e.computedTable[n][a].value.value),1)],42,["title","onMouseover","onClick"])))),128))])))),128))],4),createVNode("div",_hoisted_6,[(openBlock(!0),createBlock(Fragment,null,renderList(e.updateLogView,((e,t)=>(openBlock(),createBlock("div",{key:t},toDisplayString(e),1)))),128))]),_hoisted_7],64))));_sfc_main.render=_sfc_render,_sfc_main.__scopeId="data-v-dbab9214";export default _sfc_main;
//# sourceMappingURL=index.52349b9d.js.map
